[package]
name        = "payload_dumper"
version     = "0.8.1"
edition     = "2024"
authors     = ["rhythmcache"]
description = "A fast and efficient Android OTA payload dumper library and CLI"
repository  = "https://github.com/rhythmcache/payload-dumper-rust"
readme      = "README.md"
license     = "Apache-2.0"
homepage    = "https://github.com/rhythmcache/payload-dumper-rust"
keywords    = ["dumper", "android", "ota", "extractor", "payload"]
categories  = ["command-line-utilities", "filesystem", "compression"]

include = [
    "src/**",
    "include/**",
    "proto/update_metadata.proto",
    "LICENSE",
    "README.md",
    "Cargo.toml",
    "build.rs",
]

[lib]
name = "payload_dumper"
path = "src/lib.rs"

[[bin]]
name = "payload_dumper"
path = "src/main.rs"

[dependencies]
anyhow = "1.0.100"
digest = "0.10.7"
indicatif = "0.18.3"
prost = "0.14.1"
sha2 = "0.10.9"
num_cpus = "1.17.0"
hex = "0.4.3"
clap = { version = "4.5.53", features = ["derive"] }
serde = { version = "1.0.228", features = ["derive"] }
serde_json = "1.0.145"
tokio = { version = "1.48.0", features = [
    "rt",
    "rt-multi-thread",
    "io-util",
    "time",
    "full",
] }
futures = "0.3.31"
async-compression = { version = "0.4.36", features = [
    "zstd",
    "xz",
    "bzip2",
    "tokio",
] }
async-trait = "0.1.89"
tokio-util = { version = "0.7.17", features = ["io"], optional = true }
url = "2.5.7"
reqwest = { version = "0.12.25", features = [
    "rustls-tls-webpki-roots",
    "stream",
    "gzip",
    "http2",
], default-features = false, optional = true }
hickory-resolver = { version = "0.25.2", optional = true }
tempfile = { version = "3.23.0", optional = true }
ahash = "0.8.12"
hickory-proto = { version = "0.25.2", optional = true }
once_cell = "1.21.3"
futures-util = "0.3.31"
bsdiff = { version = "0.2.1", optional = true }

[build-dependencies]
chrono      = "0.4.42"
prost-build = "0.14.1"

[features]
default = ["local_zip", "remote_zip", "prefetch", "diff_ota"]
local_zip = []
remote_zip = ["local_zip", "dep:reqwest", "dep:tokio-util"]
hickory_dns = [
    "remote_zip",
    "dep:hickory-resolver",
    "dep:hickory-proto",
    "reqwest?/hickory-dns",
]
diff_ota = ["dep:bsdiff", "async-compression/lz4", "async-compression/brotli"]
prefetch = ["remote_zip", "dep:tempfile"]
capi = []

[package.metadata.capi.header]
name = "payload_dumper"

[package.metadata.capi.pkg_config]
name = "payload_dumper"

[package.metadata.capi.library]
name = "payload_dumper"

[profile.release]
opt-level       = 3
lto             = "fat"
codegen-units   = 1
panic           = "abort"
strip           = true
debug           = false
incremental     = false
overflow-checks = false
